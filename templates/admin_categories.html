{% if session['role']=='admin' %}

{% extends 'base.html' %}

{% block content %}
<h1 class="h3 text-center">Manage Categories</h1>
<div class="table-responsive" style="max-height: 500px; overflow-y: auto;">
  <table class="table mt-4">
    <thead>
      <tr>
        <th scope="col">Category</th>
        <th scope="col">Base Price</th>
        <th scope="col">Time required</th>
        <th scope="col">Description</th>
        <th scope="col">Status</th>
        <th scope="col">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for category in service_categories %}
      <tr>
        <td scope="row">{{category.name}}</td>
        <td scope="row">{{category.base_price}}</td>
        <td scope="row">{{category.time_required}}</td>
        <td scope="row">{{category.description}}</td>
        <td scope="row">{{category.status}}</td>
        <td scope="row">
          {% if category.status == 'active' %}
          <a href="{{url_for('deletecategory', id=category.id)}}" class="btn btn-danger">Inactive</a>
          {% else %}
          <a href="{{url_for('activecategory', id=category.id)}}" class="btn btn-success">Active</a>
          {% endif %}
          {% if category.status == 'active' %}
          <!-- Button trigger modal for editing -->
          <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#editModal{{ category.id }}">
            Edit
          </button>

          <!-- Modal for editing -->
          <div class="modal fade" id="editModal{{ category.id }}" tabindex="-1" aria-labelledby="editModalLabel{{ category.id }}" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="editModalLabel{{ category.id }}">Edit Category</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form method="POST" action="{{ url_for('editcategory', id=category.id) }}">
                  <div class="modal-body">
                    <div class="mb-3">
                      <label for="name{{ category.id }}" class="form-label">Category Name</label>
                      <input type="text" class="form-control" id="name{{ category.id }}" name="name" value="{{ category.name }}" required>
                    </div>
                    <div class="mb-3">
                      <label for="base_price{{ category.id }}" class="form-label">Base Price</label>
                      <input type="number" class="form-control" id="base_price{{ category.id }}" name="base_price" value="{{ category.base_price }}" required>
                    </div>
                    <div class="mb-3">
                      <label for="time_required{{ category.id }}" class="form-label">Time Required (in minutes)</label>
                      <input type="number" class="form-control" id="time_required{{ category.id }}" name="time_required" value="{{ category.time_required }}" required>
                    </div>
                    <div class="mb-3">
                      <label for="description{{ category.id }}" class="form-label">Description</label>
                      <textarea class="form-control" id="description{{ category.id }}" name="description" required>{{ category.description }}</textarea>
                    </div>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save changes</button>
                  </div>
                </form>
              </div>
            </div>
          </div>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  <a href="{{ url_for('addcategory') }}" class="btn btn-primary">Add Category</a>
</div>
{% endblock %}

{% else %}
<h1>Access Denied</h1>
<p>You do not have permission to access this page</p>
<a href="{{ url_for('home') }}">Go back to home</a>
{% endif %}
